{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Introduction","text":"<p>!!! missing still work in progress. More to come</p> <p>As a software developer or even as a researcher you may sometime end up in situations where you feel the need of a data center on your laptop either to develop or run more complex software systems, or just occasionally need to spin up applications you really want to isolate. If you also need to share your setup with others or just want to work in a systematic and reproducible way this repo documents a simple desire path solution based on a small collection of standard and (somewhat) mature software projects, Ansible, Molecule, Vagrant, and libvirt In addition, the repo can also be used to aggregate software and documentation from multiple independent repos as git submodules.</p>"},{"location":"#quickstart","title":"Quickstart","text":"<ol> <li>Prepare your system</li> <li>Clone the repo</li> <li>Choose a project</li> <li>Fetch an image</li> <li>Create a scenario</li> <li>Converge the scenario</li> </ol> <p>Create fedora 35 kvm vm using the molecule-libvirt driver to test a project running with the molecule-podman driver.</p> <pre><code>     $ git clone ..\n     $ cd molecular\n     $ ./bin/install.sh libvirt         # install rpm and python packages\n     $ ./bin/get fedora35               # fetches a fedora 35 qcow2 image\n     $ molecule create -s vm            # creates the fedora 35 vm\n     $ molecule converge -s vm          # run project tasks inside the vm\n     $ molecule list\n     $ molecule login -s vm             # login into the vm\n     $\n     $     git clone ..                 # clone inside the vm\n     $     cd molecular\n     $     ./bin/install.sh podman      # install rpm and python packages\n     $     molecule create -s podman    # create the container inside the vm\n     $     molecule converge -s podman  # run project tasks inside the container\n     $     molecule list\n     $     molecule login -s podman     # login into the container\n</code></pre>"},{"location":"#usage","title":"Usage","text":"<ol> <li> <p>Create a demo project from the molecule template</p> <pre><code> $ cd molecular/projects\n $ cookiecutter --config-file ../templates/molecule\n</code></pre> </li> <li> <p>Get images and start the web server</p> <pre><code>  $ make hole\n  $ make it\n</code></pre> </li> <li> <p>Create new demo scenario from scratch,</p> <pre><code>  $ demo/molelcule\n  $ molecule init -s scenario -d ...\n</code></pre> <p>or use the cookiecutter scenario template for pre-made scenarios,</p> <pre><code>  $ cd molecular/projects/demo/molecule\n  $ cookiecutter ../../../templates/scenario\n</code></pre> </li> <li> <p>Use molecule according to the documentation,</p> <pre><code>  $ cd projects/molecular\n  $ molecule list\n  $ molecule create   -s demo\n  $ molecule login    -s demo\n  $ molecule converge -s demo\n</code></pre> </li> <li> <p>Clone an existing multi-vm molecule for a specific SSH certificate scenario setup</p> <pre><code>  $ cd molecular/projects\n  $ git clone https://github.com/lmelwyn/vm.sshca\n</code></pre> </li> <li> <p>Add the documentation of a molecule to the molecular MkDocs by       placing a symlink in molecular/docs, e.g.,</p> <pre><code>  $ cd molecular/docs\n  $ ln -s ../projects/molecule_name/docs\n</code></pre> </li> </ol> <p>Here, we partly abuse molecule beyond its intended use and may occasionally have to resort to hacks to achieve a specific outcome. One example is to apply vagrant commands, such as vagrant up / down, directly in the instances vagrant environment placed cachedirs under ~/.cache/molecule.</p>"},{"location":"#installation","title":"Installation","text":"<p>Clone the repository,</p> <pre><code>      $ git clone https://github.com/lmelwyn/molecular.git\n</code></pre> <p>and install all the dependencies using the ansible playbook install.yml,</p> <pre><code>      $ ansible-playbook --ask-become-pass install.yml\n</code></pre> <p>Alternatively, do a manual installation of the distro and python packages,</p> <ol> <li> <p>install vagrant and libvirt distro packages</p> <pre><code>  $ dnf install libvirt vagrant vagrant-libvirt\n</code></pre> <p>or</p> <pre><code>  $ apt-get install libvirt vagrant vagrant-libvirt\n</code></pre> </li> <li> <p>Install the requirements, i.e., Ansible and Molecule</p> <pre><code>  $ cd molecular\n  $ pip install -r requirements.txt\n</code></pre> <p>or</p> <pre><code>  $ pip install --user ansible ansible-core ansible-compat ansible-lint\n  $ pip install --user molecule molecule-plugins['podman','vagrant'] python-vagrant\n  $ pop install --user cookiecutter mkdocs mkdocs-material\n</code></pre> </li> <li> <p>Fetch latest vagrant base VM images</p> <pre><code>  $ vagrant box add rockylinux/8\n  $ vagrant box add rockylinux/9\n  $ vagrant box add almalinux/8\n  $ vagrant box add almalinux/9\n  $ vagrant box add fedora/38-cloud-base\n  $ vagrant box add alpine/alpine64\n  $ vagrant box list\n</code></pre> </li> </ol>"},{"location":"#background","title":"Background","text":"<p>Ansible is a configuration management and orchestration tool. It allows you to define your infrastructure as code, and manage and automate the configuration and deployment of systems. Ansible uses a simple, descriptive, and human-readable language to describe your infrastructure and actions, and can be used to manage a wide range of systems, including servers, networks, and cloud environments.</p> <p>More generally Ansible may also be used as a workflow system where complex workflows can be created by organizing tasks into playbooks (executable recipes). The playbooks can then be run manually or automatically as a part of a CI/CD pipeline, allowing the automation of complex processes which ensure consistent execution and reproducibility. Additionally, Ansible's integration with other tools, such as Gitlab, allows you to incorporate Ansible into your continuous integration and deployment (CI/CD) pipelines. This can help you automate and manage complete reproducible workflows of various kinds.</p> <p>There is a large ecosystem build around ansible and many tools focus on the reuse and sharing of code. The Ansible Galaxy portal contains a huge amount of readily available open source playbooks, roles and more generally collections.</p> <p>The Ansible Molecule Python package is designed to aid in the of development and testing of Ansible roles and playbooks for configuration management and system orchestration. It is an easy and fast way to create complex multi-node test or proof-of-concept scenarios that works well with both containers and virtual machines, but Molecule may also be slightly upcycled as minimal container or virtual machine manager for personal projects to make build, runtime or data analysis workflows in containers or virtual machines.</p> <p>Historically Molecule came with a number of drivers, but recently a limited number have been moved to the ansible-community developed Molecule Plugins repository. Here we mainly use the podman and vagrant (with libvirt) plugins for user space containers or KVM virtual machines.</p> <p>There are other CLI based frameworks for managing virtual machines, such as virt-lightning or just the libvirt provided virsh, but molecule with the vagrant plugin just happens be to one that is well-integrated with Ansible and is quite simple to use in cases where certain level of isolation is required or different OS is needed.</p> <p>In more advanced cases nested virtualization allows for development and test of virtualized molecules, e.g., see the molecule.minione repo.</p> <p>Cookiecutter templates are provided for fast configuration of new molecules and scenarios. The molecule cookiecutter template initializes a MkDocs site per molecule for the documentation of the molecule.</p>"},{"location":"#links","title":"Links","text":"<ul> <li>Ansible<ul> <li>Roles</li> <li>Collections</li> </ul> </li> <li>Ansible Galaxy<ul> <li>Roles</li> <li>Collections</li> </ul> </li> <li>Libvirt</li> <li>Vagrant<ul> <li>Vagrant libvirt</li> </ul> </li> <li>Molecule<ul> <li>Molecule plugins</li> </ul> </li> <li>Cookiecutter</li> <li>MkDocs<ul> <li>Material theme</li> </ul> </li> </ul>"}]}